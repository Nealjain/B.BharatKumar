<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Auto-Refresh Monitor</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f5f5f5;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            text-align: center;
        }
        .container {
            max-width: 600px;
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 15px;
        }
        .status {
            margin: 20px 0;
            padding: 15px;
            border-radius: 5px;
            font-weight: bold;
        }
        .updated {
            background-color: #d4edda;
            color: #155724;
        }
        .checking {
            background-color: #fff3cd;
            color: #856404;
        }
        .not-updated {
            background-color: #f8d7da;
            color: #721c24;
        }
        #countdown {
            font-size: 24px;
            margin: 20px 0;
            color: #333;
        }
        .btn {
            padding: 10px 20px;
            background-color: #d4af37;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: background-color 0.3s;
        }
        .btn:hover {
            background-color: #a88a2b;
        }
        .btn-stop {
            background-color: #dc3545;
        }
        .btn-stop:hover {
            background-color: #bd2130;
        }
        .info {
            font-size: 14px;
            color: #666;
            margin-top: 20px;
        }
        .frame-container {
            width: 100%;
            height: 300px;
            overflow: hidden;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-top: 20px;
        }
        iframe {
            width: 100%;
            height: 300px;
            border: none;
        }
        #last-modified {
            font-size: 14px;
            color: #666;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>B.BharatKumar Auto-Refresh Monitor</h1>
        <p>This page will automatically check for updates and refresh the main site every 30 seconds.</p>
        
        <div id="status" class="status checking">Checking for updates...</div>
        <div id="countdown">30</div>
        <div id="last-modified">Last Modified: Checking...</div>
        
        <button id="stop-btn" class="btn btn-stop">Stop Auto-Refresh</button>
        <button id="visit-btn" class="btn">Open Main Site</button>
        
        <div class="info">
            <p>Preview of the site (updates with each refresh):</p>
        </div>
        
        <div class="frame-container">
            <iframe id="preview-frame" src="about:blank"></iframe>
        </div>
    </div>

    <script>
        // Variables
        const mainUrl = 'https://nealjain.github.io/B.BharatKumar/';
        const previewFrame = document.getElementById('preview-frame');
        const statusEl = document.getElementById('status');
        const countdownEl = document.getElementById('countdown');
        const stopBtn = document.getElementById('stop-btn');
        const visitBtn = document.getElementById('visit-btn');
        const lastModifiedEl = document.getElementById('last-modified');
        
        let countdownValue = 30;
        let countdownInterval;
        let refreshInterval;
        let lastModifiedTime = null;
        let autoRefreshActive = true;
        
        // Initialize
        function init() {
            // Set iframe source with cache-busting parameter
            updatePreview();
            
            // Start countdown
            startCountdown();
            
            // Setup refresh interval (30 seconds)
            refreshInterval = setInterval(refreshPage, 30000);
            
            // Setup button actions
            stopBtn.addEventListener('click', toggleAutoRefresh);
            visitBtn.addEventListener('click', () => {
                window.open(mainUrl + '?t=' + new Date().getTime(), '_blank');
            });
        }
        
        // Update preview frame
        function updatePreview() {
            previewFrame.src = mainUrl + '?t=' + new Date().getTime();
            checkLastModified();
        }
        
        // Check last modified time of the page
        function checkLastModified() {
            fetch(mainUrl, {
                method: 'HEAD',
                cache: 'no-store'
            })
            .then(response => {
                const lastModified = response.headers.get('last-modified');
                if (lastModified) {
                    const newModTime = new Date(lastModified).getTime();
                    
                    // Update the display
                    lastModifiedEl.textContent = 'Last Modified: ' + new Date(lastModified).toLocaleString();
                    
                    // Check if modified since last check
                    if (lastModifiedTime && newModTime > lastModifiedTime) {
                        statusEl.textContent = 'Site Updated!';
                        statusEl.className = 'status updated';
                        
                        // Play a notification sound
                        const audio = new Audio('data:audio/wav;base64,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');
                        audio.play();
                    } else if (!lastModifiedTime) {
                        statusEl.textContent = 'Monitoring for changes...';
                        statusEl.className = 'status checking';
                    } else {
                        statusEl.textContent = 'No changes detected';
                        statusEl.className = 'status not-updated';
                    }
                    
                    // Store the time for next comparison
                    lastModifiedTime = newModTime;
                }
            })
            .catch(error => {
                console.error('Error checking last modified:', error);
                statusEl.textContent = 'Error checking for updates';
                statusEl.className = 'status not-updated';
            });
        }
        
        // Start countdown timer
        function startCountdown() {
            // Clear any existing interval
            if (countdownInterval) clearInterval(countdownInterval);
            
            countdownValue = 30;
            countdownEl.textContent = countdownValue;
            
            countdownInterval = setInterval(() => {
                countdownValue--;
                countdownEl.textContent = countdownValue;
                
                if (countdownValue <= 0) {
                    countdownValue = 30;
                }
            }, 1000);
        }
        
        // Refresh the page
        function refreshPage() {
            if (!autoRefreshActive) return;
            
            // Reset countdown
            countdownValue = 30;
            
            // Update preview
            updatePreview();
        }
        
        // Toggle auto-refresh
        function toggleAutoRefresh() {
            if (autoRefreshActive) {
                // Stop auto-refresh
                clearInterval(refreshInterval);
                clearInterval(countdownInterval);
                autoRefreshActive = false;
                stopBtn.textContent = 'Resume Auto-Refresh';
                stopBtn.classList.remove('btn-stop');
                countdownEl.textContent = 'Paused';
                statusEl.textContent = 'Auto-refresh paused';
                statusEl.className = 'status checking';
            } else {
                // Resume auto-refresh
                startCountdown();
                refreshInterval = setInterval(refreshPage, 30000);
                autoRefreshActive = true;
                stopBtn.textContent = 'Stop Auto-Refresh';
                stopBtn.classList.add('btn-stop');
                updatePreview();
            }
        }
        
        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html> 